<!DOCTYPE html>
<html>
<head>
  <title>0Xnet â€“ WebRTC Client</title>
</head>
<body>

<h2>ðŸ“º Client â€“ Watching Stream</h2>
<video id="remoteVideo" autoplay playsinline muted></video>

<script>
  const HOST_IP = "172.31.91.4";
  const PORT = 3000;

  const socket = new WebSocket(`ws://${HOST_IP}:${PORT}`);

  const pc = new RTCPeerConnection({
    iceServers: [
      { urls: "stun:stun.l.google.com:19302" }
    ]
  });

  const video = document.getElementById("remoteVideo");

  pc.ontrack = (event) => {
    console.log("ðŸŽ¥ Track received");
    video.srcObject = event.streams[0];
  };

  pc.onicecandidate = (event) => {
    if (event.candidate) {
      socket.send(JSON.stringify({
        type: "ice",
        candidate: event.candidate
      }));
    }
  };

  socket.onopen = () => {
    console.log("ðŸ“¡ Client ready");
    socket.send(JSON.stringify({ type: "ready" }));
  };

  socket.onmessage = async (event) => {
    const data = JSON.parse(event.data);

    if (data.type === "offer") {
      console.log("ðŸ“¨ Offer received");
      await pc.setRemoteDescription(data.offer);
      const answer = await pc.createAnswer();
      await pc.setLocalDescription(answer);

      socket.send(JSON.stringify({
        type: "answer",
        answer
      }));
    }

    if (data.type === "ice") {
      await pc.addIceCandidate(data.candidate);
    }
  };
</script>

</body>
</html>